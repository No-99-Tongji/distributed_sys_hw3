# 编程作业 3：分布式组成员服务

**截止日期：2026-01-06 23:59**

## 1. 项目背景

在编程作业 2 中生成了 `学号-hw2.dat` 的学生成绩数据文件，并完成了一个 Client/Server 形式的文件读写 Socket 网络程序。本作业在此基础上，要求完成一个具备数据存储、查询和组成员管理功能的分布式系统。

## 2. 系统架构

该分布式系统包含两种节点：

- **N 个数据存储节点**：负责存储数据文件的数据片段。
- **1 个客户端节点**：负责接收用户指令，并与存储节点交互。

## 3. 功能要求

### 3.1 数据插入

1.  **文件分块**：客户端节点将本地数据文件 `学号-hw2.dat` 按照 **1024KB** 的大小分解为多个数据块，每个数据块编号为 `k`。
2.  **存储与复制**：对于每个数据块 `k`：
    - **随机**选择一个存储节点（假设其编号为 `n`）进行存储。
    - 同时，将该数据块**复制**到编号为 `(n+1) mod N` 的存储节点上（实现简易的冗余备份）。
3.  **存储节点文件结构**：每个存储节点（编号为 `n`）维护两个文件：
    - **`学号-hw3-n.dat`**：负责**顺序插入**收到的所有数据块内容。
    - **`学号-hw3-n.idx`**：负责保存每个数据块的索引信息，格式为三元组 `<k, ptr, size>`。
        - `k`：数据块编号。
        - `ptr`：该数据块在 `.dat` 文件中的起始指针位置。
        - `size`：该数据块的实际大小。

### 3.2 数据查询

实现与作业 2 相同的成绩查询功能：客户端接收用户输入的学号，返回该学生的五门课程明细分数信息。查询过程需要通过在存储节点间定位相关数据块来完成。

### 3.3 成员管理服务

要求设计并实现一个分布式组成员服务，使得 N 个存储节点形成一个分布式组。每个存储节点运行一个后台进程，维护一个**组成员列表**，该列表记录所有在线且已连接到组的节点成员 ID。

系统需要能在以下情况下**动态更新**组成员列表：

- **节点加入**：任何一个新节点（如 N+1 号节点）加入该组。
- **节点主动离开**：组内任一节点自愿、主动离开该组。
- **节点被动离开**：组内任一节点发生 Crash 宕机，被动离开该组（简化起见，假设最多只有 1 个节点发生故障且无法恢复）。

#### 实现方式要求（两类）

1.  **简单的 Master/Leader 方式**
    - 由一个主节点或领导者维护全局的组成员列表。

2.  **Gossip 协议方式**
    - 使用 Gossip 协议实现组服务。
    - 引入一个固定的**引荐人节点**，所有节点（包括新节点）都知道该引荐人。
    - 新节点通过联系引荐人获取当前组成员列表。
    - 如果引荐人发生故障，新节点将无法加入，但现有组成员仍可正常工作（包括故障检测）。
    - **故障检测机制**：结合 **Heartbeat（心跳）** 和 **Gossip** 两种机制。
    - **拓扑结构**：考虑节点间形成的拓扑结构。
    - **带宽优化**：为避免 N*N 的 Ping 消息带来的带宽开销，必须使用 **UDP** 网络协议来实现故障检测和通信，以确保带宽有效性。
